<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Ù„ØºØªâ€ŒÙ†Ø§Ù…Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ â€” Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</title>

<style>
/* --- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ù„Ù…Ø³ --- */
* { box-sizing: border-box; }
body, input, button, div, p, h2, h3 { user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

/* --- Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ùˆ Ø¨Ø¯Ù†Ù‡ --- */
body {
  margin:0; padding:0;
  font-family:'Vazir','Tahoma',sans-serif;
  background: url('https://uploadkon.ir/uploads/887115_2520251115-130525-616959630.jpg') no-repeat center center fixed;
  background-size: cover;
  display:flex; justify-content:center; align-items:center; min-height:100vh;
  -webkit-user-drag: none;
}

/* --- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ --- */
.container {
  width: 94%;
  max-width:480px;
  min-width:300px;
  min-height:660px;
  background: rgba(245,215,110,0.28);
  padding: 60px 20px 40px 20px;
  border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,0.18);
  display:flex; flex-direction:column; position:relative;
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  border:1px solid rgba(255,255,255,0.25);
  overflow: hidden;
}

/* --- Ù‡Ø¯Ø± Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ --- */
.header-buttons { display:flex; justify-content:space-between; margin-bottom:14px; gap:10px; }
.header-buttons button {
  width:100px; height:42px; background: rgba(255,255,255,0.18);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  color:white; border:1px solid rgba(255,255,255,0.28); border-radius:12px;
  font-weight:700; cursor:pointer; font-size:15px; transition:0.22s; box-shadow:0 6px 14px rgba(0,0,0,0.12);
}
.header-buttons button:hover { transform: translateY(-3px) scale(1.02); }

/* --- ÙÙˆÙ†Øª Ø³Ø§Ø¯Ù‡ØŒ Ø¨ÙˆÙ„Ø¯ Ùˆ ÙˆØ§Ø¶Ø­ Ø¨Ø±Ø§ÛŒ Ø¹Ù†ÙˆØ§Ù† --- */
h2 {
    text-align: center;
    font-family: 'Tahoma', 'Verdana', sans-serif;  /* ÙÙˆÙ†Øª Ø³Ø§Ø¯Ù‡ Ùˆ Ù…Ø¯Ø±Ù† */
    font-size: 50px;              /* Ø¨Ø²Ø±Ú¯ Ùˆ ÙˆØ§Ø¶Ø­ */
    font-weight: 900;             /* Ø¨Ø³ÛŒØ§Ø± Ú©Ù„ÙØª Ùˆ Ø¨ÙˆÙ„Ø¯ */
    color: #000;                  /* Ù…Ø´Ú©ÛŒ ÙˆØ§Ø¶Ø­ */
    -webkit-text-stroke: 1.2px #fff; /* Ø­Ø§Ø´ÛŒÙ‡ Ø³ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ¶ÙˆØ­ Ø¨ÛŒØ´ØªØ± */
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3); /* Ø³Ø§ÛŒÙ‡ Ù…Ù„Ø§ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚ */
    margin: 20px 0 10px 0;
    letter-spacing: 1px;          /* Ú©Ù…ÛŒ ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø­Ø±ÙˆÙ */
}


/* --- ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ --- */
.controls { display:flex; gap:10px; margin-top:6px; align-items:center; }
input[type="text"] { flex:1; padding:12px 14px; border-radius:12px; border:1px solid rgba(144,202,249,0.5); font-size:15px; background: rgba(255,255,255,0.24); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
input[type="text"]:focus { outline:none; box-shadow:0 0 10px rgba(66,165,245,0.18); border-color: rgba(66,165,245,0.6); }
.btn { padding:11px 12px; border-radius:12px; border:none; cursor:pointer; color:white; font-weight:700; font-size:14px; }
.btn.search { background: linear-gradient(135deg,#42a5f5,#1e88e5); box-shadow:0 6px 16px rgba(66,133,245,0.16); }
.btn.random { background: linear-gradient(135deg,#26a69a,#00796b); box-shadow:0 6px 16px rgba(38,166,154,0.16); }
.btn.ghost { background: rgba(255,255,255,0.14); color:#fff; border:1px solid rgba(255,255,255,0.18); }

/* --- suggestion/history/result containers --- */
.section { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
.box {
  background:#f8fcff; border-radius:14px; padding:10px; max-height:220px; overflow:auto;
  box-shadow: inset 0 6px 14px rgba(10,20,40,0.02);
}
.suggestions div, .history div, .result div {
  display:flex; gap:10px; align-items:center; padding:8px; margin:6px 0; background:#fff; border-radius:12px; cursor:pointer;
  border:1px solid rgba(144,202,249,0.45); transition:transform .15s, background .15s;
}
.suggestions div:hover, .history div:hover, .result div:hover { transform:translateY(-3px); background:#e8f3ff; }

/* thumbnail inside item */
.item-thumb { width:70px; height:70px; border-radius:10px; object-fit:cover; flex-shrink:0; background:#efefef; }

/* result text */
.item-body { display:flex; flex-direction:column; gap:6px; }

/* modal */
#modal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.55); z-index:999; padding:20px; }
#modalBox { width:100%; max-width:520px; background:white; border-radius:16px; padding:18px; box-shadow:0 18px 50px rgba(0,0,0,0.45); max-height:88vh; overflow:auto; direction:rtl; text-align:right; }
#modalBox img { width:100%; border-radius:10px; margin-bottom:12px; }

/* small helpers */
.small { font-size:13px; color:#5b6b86; }

/* prevent text selection in inputs on mobile double tap */
input::selection { background: transparent; }

/* responsive */
@media (max-width:420px) {
  .header-buttons button { width:86px; font-size:13px; }
  h2 { font-size:28px; }
  .item-thumb { width:56px; height:56px; }
}
</style>
</head>
<body>
<div class="container" role="application" aria-label="Ù„ØºØªâ€ŒÙ†Ø§Ù…Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†">
  <div class="header-buttons" role="navigation">
    <button onclick="goHome()">Ø±ÛŒØ³Øª</button>
    <button onclick="openAbout()">Ø¯Ø±Ø¨Ø§Ø±Ù‡</button>
  </div>

  <h2>Ø¯Ø§Ù†Ø§ ÙˆØ¨</h2>

  <div class="controls" aria-hidden="false">
    <input id="q" type="text" placeholder="Ú©Ù„Ù…Ù‡ ÛŒØ§ Ø¹Ø¨Ø§Ø±Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" aria-label="Ø¬Ø³ØªØ¬Ùˆ">
    <button id="searchBtn" class="btn search">Ø¬Ø³ØªØ¬Ùˆ</button>
  </div>

  <div class="section">
    <div class="box suggestions" id="suggestions" aria-live="polite"></div>
    <div class="box history" id="history"></div>
    <div class="box result" id="result" aria-live="polite"></div>
  </div>
</div>











<!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ -->
<div class="top-bar">
  <div class="logo-box">
    <img src="https://uploadkon.ir/uploads/ec1a04_25ChatGPT-Image-Dec-4-2025-07-05-14-PM-11zon.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡">
  </div>
  <div class="app-name">ØªÛŒÙˆØ§Ù†Ø§</div>
</div>

<!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ -->
<div class="top-bar">
  <div class="logo-box">
    <img src="https://uploadkon.ir/uploads/ec1a04_25ChatGPT-Image-Dec-4-2025-07-05-14-PM-11zon.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡">
  </div>
  <div class="app-name">ØªÛŒÙˆØ§Ù†Ø§</div>
</div>


<style>
/* --- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ùˆ Ø«Ø§Ø¨Øª Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ --- */
.top-bar {
    position: fixed;      /* Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ */
    top: 0;
    left: 0;
    width: 100%;          /* Ú©Ù„ Ø¹Ø±Ø¶ ØµÙØ­Ù‡ */
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, #ff9800, #f57c00);
    padding: 10px 20px;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 9999;        /* Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø¨Ù‚ÛŒÙ‡ Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ */
}

/* --- Ú©Ø§Ø¯Ø± Ù…Ø±Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ ØªØµÙˆÛŒØ± --- */
.logo-box {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid rgba(255,255,255,0.5);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    margin-right: 15px;
}

.logo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* --- Ø§Ø³Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¬Ù„ÙˆÛŒ Ø¹Ú©Ø³ --- */
.app-name {
    font-size: 24px;
    font-weight: 900;
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    font-family: 'Vazir', sans-serif;
}

/* --- ÙØ§ØµÙ„Ù‡ Ù…Ø­ØªÙˆØ§ Ø§Ø² Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ --- */
body, .container {
    padding-top: 90px; /* Ø§Ø±ØªÙØ§Ø¹ Ù†ÙˆØ§Ø± + ÙØ§ØµÙ„Ù‡ */
}
</style>




<!-- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ†ÛŒ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ -->
<div class="bottom-bar">
  <div class="ticker">
    <div class="messages" id="tickerMessages">
      <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ -->
      <span>ğŸ‰ Ù¾ÛŒØ§Ù… Ø§ÙˆÙ„: Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø¨Ù‡ ØªÛŒÙˆØ§Ù†Ø§!</span>
      <span>ğŸš€ Ù¾ÛŒØ§Ù… Ø¯ÙˆÙ…: Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø±ÙˆØ² Ø§Ø³Øª!</span>
      <span>âœ¨ Ù¾ÛŒØ§Ù… Ø³ÙˆÙ…: Ø§Ø®Ø¨Ø§Ø± Ùˆ ØªØ®ÙÛŒÙØ§Øª ÙˆÛŒÚ˜Ù‡ Ø§ÛŒÙ† Ù‡ÙØªÙ‡!</span>
    </div>
  </div>
</div>

<style>
/* --- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ†ÛŒ Ø«Ø§Ø¨Øª Ø¨Ø¯ÙˆÙ† Ø¯Ø®Ø§Ù„Øª Ø¯Ø± Ú©Ø§Ø¯Ø± Ø§ØµÙ„ÛŒ --- */
.bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(135deg, #ffb74d, #f57c00);
    padding: 8px 20px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.2);
    z-index: 9999;
    pointer-events: none; /* Ú©Ù„ÛŒÚ©â€ŒÙ‡Ø§ Ø±ÙˆÛŒ Ú©Ø§Ø¯Ø± Ø§ØµÙ„ÛŒ ØªØ§Ø«ÛŒØ± Ù†Ú¯Ø°Ø§Ø±Ø¯ */
}

/* --- Ù†ÙˆØ§Ø± Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ --- */
.ticker {
    width: 100%;
    overflow: hidden;
    position: relative;
    height: 28px;  /* Ø§Ø±ØªÙØ§Ø¹ Ù†ÙˆØ§Ø± Ù…ØªÙ† */
    pointer-events: auto; /* ÙÙ‚Ø· Ø±ÙˆÛŒ Ù…ØªÙ† ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ */
}

/* --- Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ --- */
.messages {
    display: flex;
    white-space: nowrap;
    position: absolute;
    right: 100%;   /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø®Ø§Ø±Ø¬ ØµÙØ­Ù‡ Ø³Ù…Øª Ú†Ù¾ */
    animation: tickerAnim 20s linear infinite;
}

.messages span {
    display: inline-block;
    margin-left: 50px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
    font-weight: bold;
    color: #fff;
    font-size: 15px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

/* --- Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø­Ø±Ú©Øª Ø§Ø² Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª --- */
@keyframes tickerAnim {
    0% { right: 100%; }
    100% { right: -100%; }
}
</style>


<script>
// --- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© ---
function addTickerMessage(msg){
    const ticker = document.getElementById('tickerMessages');
    const span = document.createElement('span');
    span.textContent = msg;
    ticker.appendChild(span);
}
</script>








<script>
(function(){
    const container = document.querySelector(".container");
    if(!container) return;

    // Ø§Ø¨Ø¹Ø§Ø¯ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
    const BASE_WIDTH = 480;
    const BASE_HEIGHT = 650;

    function getScreenInches(){
        const w = window.screen.width;
        const h = window.screen.height;
        const diagonalPx = Math.sqrt(w*w + h*h);
        const dpi = 160; // ÙØ±Ø¶ dpi Ù…ØªÙˆØ³Ø·
        return diagonalPx / dpi;
    }

    function applyScale(){
        const inch = getScreenInches();
        let scale = 1;

        // ---- Ú¯ÙˆØ´ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© ----
        if(inch <= 4.0) scale = 0.88;       // 4.0"
        else if(inch <= 4.3) scale = 0.92;  // 4.3"
        else if(inch <= 4.5) scale = 0.95;  // 4.5"
        else if(inch <= 4.7) scale = 0.98;  // 4.7"
        else if(inch <= 5.0) scale = 1.02;  // 5.0"
        else if(inch <= 5.3) scale = 1.06;  // 5.3"
        else if(inch <= 5.5) scale = 1.09;  // 5.5"
        else if(inch <= 6.0) scale = 1.14;  // 6.0"
        else if(inch <= 6.3) scale = 1.18;  // 6.3"
        else if(inch <= 6.5) scale = 1.22;  // 6.5"
        else if(inch <= 7.0) scale = 1.27;  // 7.0"

        // ---- ØªØ¨Ù„Øªâ€ŒÙ‡Ø§ ----
        else if(inch <= 8.0) scale = 1.33;  // 8"
        else if(inch <= 8.5) scale = 1.36;  // 8.5"
        else if(inch <= 9.0) scale = 1.39;  // 9"
        else if(inch <= 9.5) scale = 1.42;  // 9.5"
        else if(inch <= 10.0) scale = 1.46; // 10"
        else if(inch <= 10.5) scale = 1.49; // 10.5"
        else if(inch <= 11.0) scale = 1.70; // 11"
        else if(inch <= 11.5) scale = 1.80; // 11.5"
        else if(inch <= 12.0) scale = 1.90; // 12"

        // ---- Ù„Ù¾ØªØ§Ù¾/Ù…Ø§Ù†ÛŒØªÙˆØ± ----
        else if(inch <= 13.0) scale = 2.0; // 13"
        else if(inch <= 14.0) scale = 2.10; // 14"
        else if(inch <= 15.0) scale = 1.81; // 15"
        else if(inch <= 15.6) scale = 1.85; // 15.6"

        // Ø®ÛŒÙ„ÛŒ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø² 15.6 Ø§ÛŒÙ†Ú†
        else scale = 1.90;

        // Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù‡ container
        container.style.transform = `scale(${scale})`;
        container.style.transformOrigin = "top center";
        container.style.width = `${BASE_WIDTH}px`;
        container.style.height = `${BASE_HEIGHT}px`;
    }

    // Ø§Ø¬Ø±Ø§ Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ Ùˆ ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡
    window.addEventListener("load", applyScale);
    window.addEventListener("resize", applyScale);
    window.addEventListener("orientationchange", applyScale);

})();
</script>






  



<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø²Ø±Ú¯ -->
<div id="modal" role="dialog" aria-modal="true" style="display:none;">
  <div id="modalBox">
<button class="btn ghost" style="float:left; background:black; color:white;" onclick="closeModal()">Ø¨Ø³ØªÙ†</button>
    <div id="modalContent"></div>
  </div>
</div>

<script>
function openModal(content) {
    document.getElementById("modalContent").innerHTML = content;
    document.getElementById("modal").style.display = "flex";
}

function closeModal() {
    document.getElementById("modal").style.display = "none";
}

// Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø²Ù…ÛŒÙ†Ù‡ Ø¨ÛŒØ±ÙˆÙ†ÛŒ
document.getElementById("modal").addEventListener("click", function (e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>


<script>
/* ====== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ ====== */
const API_ROOT = 'https://fa.wikipedia.org/w/api.php?origin=*';
const qInput = document.getElementById('q');
const searchBtn = document.getElementById('searchBtn');
const randomBtn = document.getElementById('randomBtn');
const suggestionsEl = document.getElementById('suggestions');
const historyEl = document.getElementById('history');
const resultEl = document.getElementById('result');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');

/* ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ø² localStorage */
let historyList = JSON.parse(localStorage.getItem('searchHistory') || '[]');
/* ====== Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡â€ŒÙ‡Ø§ ====== */
function renderHistory() {
  historyEl.innerHTML = '';
  if (!historyList.length) {
    historyEl.innerHTML = '<div class="small">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>';
    return;
  }
  // Ø¯Ú©Ù…Ù‡ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
  const clearBtn = document.createElement('div');
  clearBtn.innerHTML = '<strong class="small">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡</strong>';
  clearBtn.style.textAlign = 'center';
  clearBtn.style.cursor = 'pointer';
  clearBtn.onclick = () => { historyList = []; localStorage.removeItem('searchHistory'); renderHistory(); };
  historyEl.appendChild(clearBtn);

  historyList.forEach(item => {
    const d = document.createElement('div');
    d.textContent = item;
    d.onclick = () => { qInput.value = item; searchAndShow(item); };
    historyEl.appendChild(d);
  });
}

function saveHistory(term) {
  if (!term) return;
  // Ø­Ø°Ù Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ø±Ø§Ø±ÛŒ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ø§ÙˆÙ„
  historyList = historyList.filter(x => x !== term);
  historyList.unshift(term);
  if (historyList.length > 20) historyList = historyList.slice(0,20);
  localStorage.setItem('searchHistory', JSON.stringify(historyList));
  renderHistory();
}

function showModal(html) {
  modalContent.innerHTML = html;
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}
function closeModal(e) {
  if (e && e.target !== modal) return;
  modal.style.display = 'none';
  modalContent.innerHTML = '';
  document.body.style.overflow = '';
}







/* ====== Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ… Ù†ØªÛŒØ­Ù‡ Ø¨Ø§ Ø¹Ú©Ø³ Ú©ÙˆÚ†Ú© ====== */
function makeResultItem(title, extract, thumbUrl, pageid) {
  const wrapper = document.createElement('div');
  wrapper.style.alignItems = 'flex-start';
  // thumbnail
  if (thumbUrl) {
    const img = document.createElement('img');
    img.src = thumbUrl;
    img.className = 'item-thumb';
    wrapper.appendChild(img);
  }
  const body = document.createElement('div');
  body.className = 'item-body';
  const t = document.createElement('strong'); t.textContent = title;
  const p = document.createElement('div'); p.textContent = extract || '';
  const link = document.createElement('a'); link.href = 'https://fa.wikipedia.org/?curid=' + pageid; link.target = '_blank';
  link.textContent = 'Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙˆÛŒÚ©ÛŒâ€ŒÙ¾Ø¯ÛŒØ§ â€º';
  link.className = 'small';
  body.appendChild(t); body.appendChild(p); body.appendChild(link);
  wrapper.appendChild(body);

  // Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ (Ù†Ù…Ø§ÛŒØ´ Ø¨Ø²Ø±Ú¯ØªØ± Ùˆ Ù…ØªÙ† Ú©Ø§Ù…Ù„)
  wrapper.onclick = async (e) => {
    e.preventDefault();
    // show modal with fuller content (try rest summary)
    try {
      const resp = await fetch('https://fa.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(title));
      if (resp.ok) {
        const data = await resp.json();
        let html = '';
        if (data.thumbnail && data.thumbnail.source) html += '<img src="'+data.thumbnail.source+'" alt="">';
        html += '<h3>' + (data.title || title) + '</h3>';
        html += '<p>' + (data.extract || '') + '</p>';
        if (data.content_urls && data.content_urls.desktop) html += '<p style="margin-top:8px;"><a href="'+data.content_urls.desktop.page+'" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø¯Ø± ÙˆÛŒÚ©ÛŒâ€ŒÙ¾Ø¯ÛŒØ§</a></p>';
        showModal(html);
      } else {
        showModal('<p>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„.</p>');
      }
    } catch(err) {
      console.error(err);
      showModal('<p>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª.</p>');
    }
  };

  return wrapper;
}

/* ====== Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù†ØªØ§ÛŒØ¬ ====== */
let debounceTimer = null;
qInput.addEventListener('input', () => {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(handleSuggest, 250);
});

async function handleSuggest() {
  const term = qInput.value.trim();
  suggestionsEl.innerHTML = '';
  if (!term) return;
  try {
    const s = await fetch(API_ROOT + '&action=opensearch&format=json&search=' + encodeURIComponent(term) + '&limit=6').then(r=>r.json());
    const titles = s[1] || [];
    titles.forEach(t => {
      const d = document.createElement('div');
      d.textContent = t;
      d.onclick = () => { qInput.value = t; searchAndShow(t); };
      suggestionsEl.appendChild(d);
    });
  } catch(err) {
    suggestionsEl.innerHTML = '';
  }
}

async function searchAndShow(term) {
  if (!term || !term.trim()) return;
  resultEl.innerHTML = '<div class="small">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</div>';
  try {
    // 1) Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¹Ù†ÙˆØ§Ù†â€ŒÙ‡Ø§
    const srResp = await fetch(API_ROOT + '&action=query&list=search&format=json&srsearch=' + encodeURIComponent(term) + '&srlimit=6');
    const sr = await srResp.json();
    if (!sr.query || !sr.query.search || sr.query.search.length === 0) {
      resultEl.innerHTML = '<div class="small">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
      return;
    }

    // Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¹Ù†ÙˆØ§Ù†ØŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ù„Ø§ØµÙ‡ Ùˆ thumbnail Ø±Ø§ Ø¨Ú¯ÛŒØ±
    const titles = sr.query.search.slice(0,6).map(s => s.title);
    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØµÙØ­Ø§Øª (extract + thumbnail)
    const params = new URLSearchParams({
      action: 'query',
      prop: 'extracts|pageimages',
      exintro: '1',
      explaintext: '1',
      piprop: 'thumbnail',
      pithumbsize: '400',
      titles: titles.join('|'),
      format: 'json'
    });
    const detailResp = await fetch(API_ROOT + '&' + params.toString());
    const details = await detailResp.json();
    const pages = details.query && details.query.pages ? details.query.pages : {};
    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ suggestions
    suggestionsEl.innerHTML = '';
    // Ø±Ù†Ø¯Ø± Ù†ØªØ§ÛŒØ¬ (ÛŒÚ©ÛŒ ÛŒÚ©ÛŒ)
    resultEl.innerHTML = '';
    Object.keys(pages).forEach(k => {
      const p = pages[k];
      const title = p.title;
      const extract = p.extract || '';
      const thumb = p.thumbnail && p.thumbnail.source ? p.thumbnail.source : null;
      const pageid = p.pageid;
      const item = makeResultItem(title, extract, thumb, pageid);
      resultEl.appendChild(item);
    });

    saveHistory(term);
  } catch (err) {
    console.error(err);
    resultEl.innerHTML = '<div class="small">Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ÙˆÛŒÚ©ÛŒâ€ŒÙ¾Ø¯ÛŒØ§</div>';
  }
}

/* ØµÙØ­Ù‡ ØªØµØ§Ø¯ÙÛŒ */
randomBtn.addEventListener('click', async () => {
  try {
    const r = await fetch(API_ROOT + '&action=query&format=json&list=random&rnnamespace=0&rnlimit=1').then(r=>r.json());
    const title = r.query.random[0].title;
    qInput.value = title;
    searchAndShow(title);
  } catch (err) {
    console.error(err);
    resultEl.innerHTML = '<div class="small">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØµÙØ­Ù‡Ù” ØªØµØ§Ø¯ÙÛŒ</div>';
  }
});

/* Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ ÛŒØ§ Ø§ÛŒÙ†ØªØ± */
searchBtn.addEventListener('click', ()=>searchAndShow(qInput.value));
qInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') { e.preventDefault(); searchAndShow(qInput.value); } });

/* ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ */
(function init() {
  renderHistory();
  // Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ù†Ù…Ø§ÛŒØ´ ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡
  // qInput.value = 'Ú¯Ø±Ø¨Ù‡'; searchAndShow('Ú¯Ø±Ø¨Ù‡');
})();

/* Ø®Ø§Ù†Ù‡ Ùˆ Ø¯Ø±Ø¨Ø§Ø±Ù‡ */
function goHome(){ qInput.value=''; suggestionsEl.innerHTML=''; resultEl.innerHTML=''; }
function openAbout(){ showModal('<h3>Ø¯Ø±Ø¨Ø§Ø±Ù‡</h3><p>Ø§ÛŒÙ† Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù„ØºØªâ€ŒÙ†Ø§Ù…Ù‡ Ø§Ø² ÙˆÛŒÚ©ÛŒâ€ŒÙ¾Ø¯ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø·Ø±Ø§Ø­ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†ÛŒØŒ Ù†Ù…Ø§ÛŒØ´ ØªØµØ§ÙˆÛŒØ±ØŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ù‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¯Ø§Ø±Ø¯.</p>'); }

/* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ùˆ Ù…ÛŒØ§Ù†Ø¨Ø±Ù‡Ø§ÛŒ Ú©Ù¾ÛŒ */
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && ['c','x','s','u','a'].includes((e.key||'').toLowerCase())) e.preventDefault();
  if (e.key === 'F12') e.preventDefault();
});

/* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ…/Ù¾ÛŒÙ†Ú† */
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('touchmove', e => { if (e.scale && e.scale !== 1) e.preventDefault(); }, { passive:false });
</script>
</body>
</html>
